{{!-- <div id="preloader">
    <div class="lds-ripple">
        <div></div>
        <div></div>
    </div>
</div> --}}



<body>
    <div id="main-wrapper">
    <!--Nav header end-->
    <div class="nav-header">
        <a href="/" class="brand-logo">
            <div class="column">
              <img
          class="logo-abbr"
          width="40px"
          height="45px"
          src="/images/logo.png"
        />
            </div>
        </a>
        <div class="nav-control">
            <div class="hamburger">
                <span class="line"></span><span class="line"></span><span class="line"></span>
            </div>
        </div>
    </div>
    <!--Nav header end-->

    <!--Header start-->
    <div class="header">
        <div class="header-content">
            <nav class="navbar navbar-expand">
                <div class="collapse navbar-collapse justify-content-between">
                    <div class="header-left">
                        <div class="headaer-title">
                            <h1 class="font-w600 mb-0">Điểm du lịch</h1>
                        </div>
                    </div>
                    <ul class="navbar-nav header-right">
                        {{!-- DatePicker --}}
                        <li class="nav-item dropdown header-profile">
                            <div id="datepicker" class="input-group date dz-calender" data-date-format="mm-dd-yyyy">
                                <span class="input-group-addon d-flex align-items-center">
                                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M14.8337 3.16667H14.0003V1.50001C14.0003 1.27899 13.9125 1.06703 13.7563 0.910749C13.6 0.754469 13.388 0.666672 13.167 0.666672C12.946 0.666672 12.734 0.754469 12.5777 0.910749C12.4215 1.06703 12.3337 1.27899 12.3337 1.50001V3.16667H5.66699V1.50001C5.66699 1.27899 5.5792 1.06703 5.42292 0.910749C5.26663 0.754469 5.05467 0.666672 4.83366 0.666672C4.61265 0.666672 4.40068 0.754469 4.2444 0.910749C4.08812 1.06703 4.00033 1.27899 4.00033 1.50001V3.16667H3.16699C2.50395 3.16667 1.86807 3.43006 1.39923 3.8989C0.930384 4.36775 0.666992 5.00363 0.666992 5.66667V6.5H17.3337V5.66667C17.3337 5.00363 17.0703 4.36775 16.6014 3.8989C16.1326 3.43006 15.4967 3.16667 14.8337 3.16667Z"
                                            fill="#F66F4D" />
                                        <path
                                            d="M0.666992 14.8333C0.666992 15.4964 0.930384 16.1322 1.39923 16.6011C1.86807 17.0699 2.50395 17.3333 3.16699 17.3333H14.8337C15.4967 17.3333 16.1326 17.0699 16.6014 16.6011C17.0703 16.1322 17.3337 15.4964 17.3337 14.8333V8.16666H0.666992V14.8333Z"
                                            fill="#F66F4D" />
                                    </svg>
                                </span>
                                <input class="form-control" type="text" readonly />
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>
    <!--Header end ti-comment-alt-->

    <!--Sidebar start-->
    <div class="deznav">
        <div class="deznav-scroll">
            <ul class="metismenu" id="menu">
                <li><a class="has-arrow " href="/" aria-expanded="false">
                        <i class="flaticon-025-dashboard"></i>
                        <span class="nav-text">Thống kê</span>
                    </a>
                </li>
                <li><a class="has-arrow " href="/cpanel/users" aria-expanded="false">
                        <i class="flaticon-006-brightness"></i>
                        <span class="nav-text">Tài khoản</span>
                    </a>
                </li>
                <li><a class="has-arrow " href="/cpanel/locations" aria-expanded="false">
                        <i class="flaticon-017-clipboard"></i>
                        <span class="nav-text">Điểm du lịch</span>
                    </a>
                </li>
                <li><a class="has-arrow " href="/cpanel/tours" aria-expanded="false">
                        <i class="flaticon-017-clipboard"></i>
                        <span class="nav-text">Chuyến du lịch</span>
                    </a>
                </li>
                <li><a class="has-arrow " href="/cpanel/events" aria-expanded="false">
                        <i class="flaticon-086-star"></i>
                        <span class="nav-text">Sự kiện</span>
                    </a>
                </li>
                <li><a class="has-arrow " href="/cpanel/blogs" aria-expanded="false">
                        <i class="flaticon-022-copy"></i>
                        <span class="nav-text">Bài viết</span>
                    </a>
                </li>
                <li><a class="has-arrow " href="/logout" aria-expanded="false">
                        <i class="flaticon-061-outside"></i>
                        <span class="nav-text">Đăng xuất</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <!--Sidebar end-->
    <!--Content body start-->
    <div class="content-body">
        <!-- row -->
        <div class="container-fluid">
            <div class=" d-block d-lg-flex align-items-center justify-content-between mb-5">
                {{!-- Tất cả, Đang diễn ra, Đã xong --}}
                <div class="coin-tabs">
                    <ul class="nav nav-tabs " id="ListViewTabLink" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="all-status-tab" data-bs-toggle="tab"
                                data-bs-target="#all-status" type="button" role="tab" aria-controls="all-status"
                                aria-selected="true">Tất cả</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="available-tab" data-bs-toggle="tab" data-bs-target="#available"
                                type="button" role="tab" aria-controls="available" aria-selected="false">Hiển
                                thị</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="soldout-tab" data-bs-toggle="tab" data-bs-target="#soldout"
                                type="button" role="tab" aria-controls="soldout" aria-selected="false">Đã ẩn</button>
                        </li>
                    </ul>
                </div>
                {{!-- Thêm tour --}}
                <div class="form-head d-inline-block d-sm-flex align-items-center mt-2 mt-lg-0">
                    <div class="align-items-center justify-content-center">
                        <a href="/cpanel/locations/addLocation" class="btn btn-success btn-sm">
                            Thêm
                        </a>
                    </div>
                </div>
            </div>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="list" aria-labelledby="list-tab">
                    <div class="tab-content" id="ListViewTabLinkContent">

                        <div class="tab-pane fade active show" id="all-status" aria-labelledby="boxed-all-status-tab">
                            <div class="table-responsive card">
                                <div class="table-responsive">
                                    <table
                                        class="table border-0 display mb-4 dataTablesCard booking-table table-responsive-lg "
                                        id="guestTable-all6">
                                        <thead>
                                            <tr>
                                                <th>Nổi bật</th>
                                                <th>Thông tin</th>
                                                <th>Địa điểm</th>
                                                {{!-- <th>Mô tả</th> --}}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {{#each locations}}
                                            <tr>
                                                <td>
                                                    <div class="form-check style-3">
                                                        {{!-- <input class="form-check-input" type="checkbox" value=""> --}}
                                                        {{#if this.is_popular}}
                                                        <input name="is_popular" class="form-check-input" type="checkbox" value="" checked onclick="confirmUpdatePopular('{{this._id}}', {{this.is_popular}})">
                                                        {{else}}
                                                        <input name="is_popular" class="form-check-input" type="checkbox" value="" onclick="confirmUpdatePopular('{{this._id}}', {{this.is_popular}})">
                                                        {{/if}}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="guest-bx">
                                                        <img class="me-4" src="{{this.image}}" alt="">
                                                        <div>
                                                            <h4 class="mb-0 mt-1 fs-18 font-w500 text-nowrap">
                                                                <a class="text-black" href="/locations/{{this._id}}/detail">
                                                                    {{this.name}}
                                                                </a>
                                                            </h4>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div>
                                                        <span
                                                            class="fs-15 font-w500 text-nowrap">{{this.province_id.name}}</span>
                                                    </div>
                                                </td>
                                                {{!-- <td>
                                                    <div>
                                                        <h5 class="fs-15 font-w500 text-nowrap">{{this.description}}
                                                        </h5>
                                                    </div>
                                                </td> --}}
                                                <td>
                                                    <div class="dropdown dropstart justify-content-center ">
                                                        <button onclick="confirmDelete('{{this._id}}');" class="btn btn-danger btn-xs"
                                                            aria-expanded="false">
                                                            <svg xmlns="http://www.w3.org/2000/svg" height="1.5em"
                                                                viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                                                                <style>
                                                                    svg {
                                                                        fill: #ffffff
                                                                    }
                                                                </style>
                                                                <path
                                                                    d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z" />
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            {{/each}}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                  

                      
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
  const fetchAPI = async (url, option) => {
    const res = await fetch(url, option);
    return res.json();
  }
  const deleteProduct = async (id) => {
    const url = `/cpanel/locations/${id}/delete`;
    const option = {
      method: 'get',
      headers: { 'Content-Type': 'application/json' }
    }
    try {
      const result = await fetchAPI(url, option);
      if (result) {
        swal("Xóa thành công!", { icon: "success" });
        setTimeout(function () {
          window.location.reload();
        }, 2000);

      } else {
        swal("Xóa thất bại!", { icon: "error" });
      }

    } catch (e) {
      console.log('Delete ERROR:', e);
    }
  }

  const updatePopular = async (id, is_popular) => {
    const url = `/cpanel/locations/${id}/popular/${is_popular}`;
    const option = {
      method: 'post',
      headers: { 'Content-Type': 'application/json' }
    }
    try {
      const result = await fetchAPI(url, option);
      if (result) {
        swal("Thay đổi thành công!", { icon: "success" });
        setTimeout(function () {
          window.location.reload();
        }, 2000);

      } else {
        swal("Thay đổi thất bại!", { icon: "error" });
      }

    } catch (e) {
      console.log('Update popular ERROR:', e);
    }
  }
  const confirmDelete = (id) => {
    swal({
      title: "Xác nhận xóa ???",
      text: "",
      icon: "warning",
      buttons: true,
      dangerMode: true,
    })
      .then((willDelete) => {
        if (willDelete) {

          deleteProduct(id);

        }
      });
  }

  const confirmUpdatePopular = (id, is_popular) => {
    swal({
      title: "Xác nhận thay đổi",
      text: "",
      icon: "warning",
      buttons: true,
      dangerMode: true,
    })
      .then((willUpdate) => {
        if (willUpdate) {
          updatePopular(id, is_popular);
        }
      });
  }

</script>